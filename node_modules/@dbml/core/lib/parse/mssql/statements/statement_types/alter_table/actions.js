"use strict";

var _ = require('lodash');

function handleRef(tableName, result) {
  var endpointWithNoTableName = result.value.endpoints.find(function (ele) {
    return !ele.tableName;
  });
  endpointWithNoTableName.tableName = _.last(tableName);
}

function addTableName(tableName, result) {
  result.value.tableName = _.last(tableName);
}

function handleAlterTableResult(_keyword, tableName, results) {
  if (!results) return null; // eslint-disable-next-line consistent-return

  results.forEach(function (result) {
    if (result) {
      switch (result.type) {
        case 'refs':
          handleRef(tableName, result);
          break;

        case 'indexes':
        case 'dbdefault':
        case 'enums':
          addTableName(tableName, result);
          break;

        default:
          break;
      }
    }
  });
  return results;
}

module.exports = {
  handleAlterTableResult: handleAlterTableResult
};